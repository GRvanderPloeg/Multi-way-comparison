"0","microbiome_raw = read.csv(""./Data/AP/20240429_microbiome_counts.csv"", sep="" "", header=FALSE)"
"0","taxonomy = read.csv(""./Data/AP/20240429_taxonomy.csv"", sep="" "", header=FALSE)"
"0","subjectMeta2 = read.csv(""./Data/AP/20240429_microbiome_sampleMeta.csv"", sep="" "", header=FALSE)"
"0",""
"0","remove = c(""A11-18"", ""A11-3"", ""A11-8 36"", ""A11-10 17"", ""A11-15 17"")"
"0","mask = !(subjectMeta2[,3] %in% remove)"
"0",""
"0","microbiome_raw = microbiome_raw[mask,]"
"0","subjectMeta2 = subjectMeta2[mask,]"
"0",""
"0","# Select ASVs based on sparsity per group"
"0","sparsityThreshold = 0.5"
"0",""
"0","maskA = subjectMeta2[,4] == ""A"""
"0","maskS = subjectMeta2[,4] == ""S"""
"0",""
"0","microbiomeA = microbiome_raw[maskA,]"
"0","microbiomeS = microbiome_raw[maskS,]"
"0",""
"0","sparsityA = colSums(microbiomeA==0) / nrow(microbiomeA)"
"0","sparsityS = colSums(microbiomeS==0) / nrow(microbiomeS)"
"0",""
"0","featureMask = (sparsityA <= sparsityThreshold) | (sparsityS <= sparsityThreshold)"
"0",""
"0","# CLR transformation"
"0","geomeans = pracma::geomean(as.matrix(microbiome_raw+1), dim=2)"
"0","microbiome_clr = log(sweep(microbiome_raw+1, 1, geomeans, FUN=""/""))"
"0",""
"0","# Reduce to previously selected ASVs"
"0","microbiome_selected = microbiome_clr[,featureMask]"
"0","taxonomy_selected = taxonomy[featureMask,]"
"0",""
"0","# Center and scale"
"0","microbiome_cnt = sweep(microbiome_selected, 2, colMeans(microbiome_selected), FUN=""-"")"
"0","microbiome_cnt_scl = sweep(microbiome_cnt, 2, apply(microbiome_cnt, 2, sd), FUN=""/"")"
